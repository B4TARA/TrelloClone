@model TrelloClone.ViewModels.ListArchiveCards


<div class="home-content">
    <div class="home_content_info">


        <div class="home_content_info_icon">
            <i class="fa-solid fa-folder"></i>
        </div>


        <div class="mid_title">
            @Model.Name
        </div>
    </div>
</div>


<div class="header_btns_wrapper">


    @if (User.FindFirst("Id") != null && Convert.ToInt32(User.FindFirst("Id")!.Value) == Model.Id)
    {


        <a class="action_btn header_btn" asp-controller="UserBoard" asp-action="ListMyCards">


            <div class="action_btn_icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M2 2h20v2H2z"></path>
                    <rect x="5" y="6" width="6" height="16" rx="1"></rect>
                    <rect x="13" y="6" width="6" height="12" rx="1"></rect>
                </svg>
            </div>


            <div class="description">Доска</div>
        </a>


        <a class="action_btn header_btn" asp-controller="UserBoard" asp-action="ListMyCardsTable">


            <div class="action_btn_icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M2 2h2v20H2z"></path>
                    <rect x="6" y="13" width="16" height="6" rx="1"></rect>
                    <rect x="6" y="5" width="12" height="6" rx="1"></rect>
                </svg>
            </div>


            <div class="description">Список</div>
        </a>
    }


    else
    {
        <a class="action_btn header_btn" asp-controller="UserBoard" asp-action="ListEmployeeCards" asp-route-employeeId="@Model.Id">


            <div class="action_btn_icon ">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M2 2h20v2H2z"></path>
                    <rect x="5" y="6" width="6" height="16" rx="1"></rect>
                    <rect x="13" y="6" width="6" height="12" rx="1"></rect>
                </svg>
            </div>


            <div class="description">Доска</div>
        </a>


        <a class="action_btn header_btn" asp-controller="UserBoard" asp-action="ListEmployeeCardsTable" asp-route-employeeId="@Model.Id">


            <div class="action_btn_icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M2 2h2v20H2z"></path>
                    <rect x="6" y="13" width="16" height="6" rx="1"></rect>
                    <rect x="6" y="5" width="12" height="6" rx="1"></rect>
                </svg>
            </div>


            <div class="description">Список</div>
        </a>
    }


    <a class="action_btn header_btn active" asp-controller="UserBoard" asp-action="ListArchiveCards" asp-route-userId="@Model.Id">


        <div class="action_btn_icon ">
            <i class="fa-solid fa-box-archive"></i>
        </div>


        <div class="description">Архив</div>
    </a>
</div>


<section class="main_container_content" id="main_container_content">
    <div class="list_view_container">


        <div class="list_view_main_wrapper">
            <table class="table_list_view margin_container_bottom_middle">


                <thead>
                    <tr>
                        <th class="blue_bcolor_highcontrast">Архив</th>
                        <th class="extra_info"></th>
                        <th>Создал</th>
                        <th>Плановая дата</th>
                        <th>Фактическая дата</th>
                        <th>Оценка сотрудника</th>
                        <th>Оценка руководителя</th>
                    </tr>
                </thead>


                <tbody>
                    @if (Model.ArchivedCards.Count() != 0)
                    {
                        @foreach (var card in Model.ArchivedCards)
                        {
                            <tr class="open-popup" idcard="@card.Id">


                                <td class="table_title_wrapper">
                                    <div class="stage_indicator_circle blue_bcolor"></div>
                                    <div class="info_table_title_wrapper">
                                        <div class="description">
                                            @card.Name
                                        </div>
                                    </div>
                                </td>


                                <td>
                                    <div class="card_details_info_wrapper">


                                        <div class="card_detail_item">
                                            <div class="item_icon">
                                                <i class="fa-regular fa-message" style="color: #787486;"></i>
                                            </div>
                                            <div class="item_count">
                                                <div class="mid_description">
                                                    @card.CountOfComments
                                                </div>
                                            </div>
                                        </div>


                                        <div class="card_detail_item">
                                            <div class="item_icon">
                                                <i class="fa-solid fa-paperclip" style="color: #787486;"></i>
                                            </div>
                                            <div class="item_count">
                                                <div class="mid_description">
                                                    @card.CountOfFiles
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>


                                <td>
                                    @if (Model.ImgPath != null)
                                    {
                                        <div class="card_holders_wrapper">
                                            <div class="holder_image_wrapper" style="background-image:url('@Model.ImgPath');"></div>
                                        </div>
                                    }


                                    else
                                    {
                                        <div class="card_holders_wrapper">
                                            <div class="holder_image_wrapper" style="background-image:url('/image/default_profile_icon.svg');"></div>
                                        </div>
                                    }
                                </td>


                                <td>
                                    <div class="card_name_wrapper">
                                        <div class="mid_description">
                                            @card.Term.ToString("MMMM yyyy")
                                        </div>
                                    </div>
                                </td>


                                <td>
                                    @if (card.FactTerm != default(DateTime))
                                    {
                                        <div class="mid_description">
                                            -
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="card_name_wrapper">
                                            <div class="mid_description">
                                                @card.FactTerm.ToString("MMMM yyyy")
                                            </div>
                                        </div>
                                    }
                                </td>


                                <td>
                                    @card.EmployeeAssessment
                                </td>


                                <td>
                                    @card.SupervisorAssessment
                                </td>

                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td class="table_title_wrapper">
                            </td>

                            <td>
                            </td>

                            <td>
                            </td>

                            <td>
                            </td>

                            <td>
                            </td>

                            <td>
                            </td>

                            <td>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>


        <div class="list_view_main_wrapper">
            <table class="table_list_view margin_container_bottom_middle">


                <thead>
                    <tr>
                        <th class="red_bcolor_highcontrast">Удаленные</th>
                        <th class="extra_info"></th>
                        <th>Создал</th>
                        <th>Плановая дата</th>
                        <th>Фактическая дата</th>
                        <th>Оценка сотрудника</th>
                        <th>Оценка руководителя</th>
                    </tr>
                </thead>


                <tbody>
                    @if (Model.DeletedCards.Count() != 0)
                    {
                        @foreach (var card in Model.DeletedCards)
                        {
                            <tr class="open-popup" idcard="@card.Id">


                                <td class="table_title_wrapper">
                                    <div class="stage_indicator_circle blue_bcolor"></div>
                                    <div class="info_table_title_wrapper">
                                        <div class="description">
                                            @card.Name
                                        </div>
                                    </div>
                                </td>


                                <td>
                                    <div class="card_details_info_wrapper">


                                        <div class="card_detail_item">
                                            <div class="item_icon">
                                                <i class="fa-regular fa-message" style="color: #787486;"></i>
                                            </div>
                                            <div class="item_count">
                                                <div class="mid_description">
                                                    @card.CountOfComments
                                                </div>
                                            </div>
                                        </div>


                                        <div class="card_detail_item">
                                            <div class="item_icon">
                                                <i class="fa-solid fa-paperclip" style="color: #787486;"></i>
                                            </div>
                                            <div class="item_count">
                                                <div class="mid_description">
                                                    @card.CountOfFiles
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>


                                <td>
                                    @if (User.FindFirst("ImagePath") != null)
                                    {
                                        <div class="card_holders_wrapper">
                                            <div class="holder_image_wrapper" style="background-image:url('@User.FindFirst("ImagePath")!.Value');"></div>
                                        </div>
                                    }


                                    else
                                    {
                                        <div class="card_holders_wrapper">
                                            <div class="holder_image_wrapper" style="background-image:url('/image/default_profile_icon.svg');"></div>
                                        </div>
                                    }
                                </td>


                                <td>
                                    <div class="card_name_wrapper">
                                        <div class="mid_description">
                                            @card.Term.ToString("MMMM yyyy")
                                        </div>
                                    </div>
                                </td>


                                <td>
                                    <div class="card_name_wrapper">
                                        <div class="mid_description">
                                            @card.FactTerm.ToString("MMMM yyyy")
                                        </div>
                                    </div>
                                </td>


                                <td>
                                    @card.EmployeeAssessment
                                </td>


                                <td>
                                    @card.SupervisorAssessment
                                </td>

                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td class="table_title_wrapper">
                            </td>

                            <td>
                            </td>

                            <td>
                            </td>

                            <td>
                            </td>

                            <td>
                            </td>

                            <td>
                            </td>

                            <td>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</section>


<script>


    //async function getReport() {
    //    const response = await fetch('/UserBoard/GetReport', {
    //        headers: {
    //            'Content-Type': 'application/json;charset=utf-8'
    //        },
    //        method: 'GET',
    //    })
    //    const result = await response.json();
    //    window.open(`../${result}`, "_blank");
    //}

    let downloadExcelBtn = {
        content: 'Показать отчет',
        className: 'custom-button-classname',
        onClick: (dp) => {
            let viewDate = document.getElementById('input-datepicker').value
            console.log(typeof (viewDate))
            getReport(viewDate)
            //    postRangeDate(viewDate)
            //    console.log(viewDate)
        }

    }

    new AirDatepicker('#input-datepicker', {
        range: true,
        multipleDatesSeparator: ' - ',
        buttons: [downloadExcelBtn],
        //onSelect({ date, formattedDate, datepicker }) {
        //    if (formattedDate.length == 2) {
        //        let searchDate = formattedDate[0]

        //        dateList.forEach(option => {
        //            let label = option.innerText.toLowerCase();
        //            let rowElem = option.parentNode;
        //            if (label.indexOf(searchDate) != -1) {
        //                rowElem.style.display = "table-row";

        //            } else {
        //                rowElem.style.display = "none";

        //            }
        //        });

        //        console.log(formattedDate[0])
        //        console.log(formattedDate[1])
        //        getReport(formattedDate[0], formattedDate[1])
        //    }
        //},

        // isMobile: true,
        // autoClose: true,
    });


    function getReport(viewDate) {

        var url = "/UserBoard/GetReport";
        formData = new FormData();
        formData.append("viewDate", viewDate);

        $.ajax({
            url: url,
            type: 'POST',
            data: formData,
            cache: false,
            contentType: false,
            processData: false,
            success: async function (response) {
                console.log(response);
                const result = response;
                window.open(`../${result}`, "_blank");
            }
        });
    }


</script>